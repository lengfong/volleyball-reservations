<meta charset="UTF-8">
<title></title>
<style type="text/css">body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
        h1, h2 { text-align: center; color: #333; }
        /* Roster List Styles */
        #position-list { list-style: none; padding: 0; width: 600px; max-width: 90%; margin: 20px auto; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        #position-list li { padding: 10px 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        #position-list li:last-child { border-bottom: none; }
        .pos-label { font-weight: bold; }
        /* Reserved Slot Styles */
        .reserved-slot { background-color: #f8d7da; color: #721c24; text-decoration: line-through; }
        /* Available Slot Styles */
        .available-slot { background-color: #d4edda; color: #155724; cursor: pointer; transition: background-color 0.2s; }
        .available-slot:hover { background-color: #c3e6cb; }
        .player-info { font-style: italic; color: #007bff; }
        /* Form/Message Styles */
        #reservation-form { width: 400px; min-width: 300px; margin: 30px auto; padding: 25px; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center; }
        #reservation-form h3 { margin-bottom: 15px; }
        #reservation-form input { margin: 8px 0; padding: 10px; width: 100%; box-sizing: border-box; border: 1px solid #ced4da; border-radius: 4px; }
        #message { margin-top: 15px; padding: 10px; border-radius: 4px; }
        .error { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }
        .success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
</style>
<h1>üèê Volleyball Pool Reservation</h1>

<h2 id="match-details">&nbsp;</h2>

<div id="reservation-form">
<h3>1. Enter Your Name</h3>
<input id="player-name" placeholder="Your Name" required="" type="text" />
<h3>2. Click an OPEN Slot Below</h3>

<p id="message">&nbsp;</p>
</div>

<ul id="position-list">
</ul>
<script>
        // The "Live Database" stored in a JavaScript object
        const MATCH_DATA = {
            matchId: 101,
            date: "2025-12-05",
            time: "7:00 PM",
            reservations: [] // Single array for all 12 players
        };

        // Define the required slots and maximums
        const MAX_SLOTS = {
            Setter: 2,
            Outside: 4,
            Middle: 4,
            RS: 2,
            Total: 12
        };

        // Helper to get current reservation counts for the entire pool
        function getPoolCounts() {
            const reservations = MATCH_DATA.reservations;
            const counts = {
                Setter: 0,
                Outside: 0,
                Middle: 0,
                RS: 0,
                Total: reservations.length
            };

            reservations.forEach(r => {
                counts[r.position]++;
            });
            return counts;
        }

        // Function called when an OPEN slot is clicked
        function handleReservationClick(position) {
            const playerName = document.getElementById('player-name').value.trim();
            const messageElement = document.getElementById('message');
            
            if (!playerName) {
                messageElement.className = 'error';
                messageElement.textContent = 'üö´ Please enter your name first.';
                return;
            }
            
            // Proceed with reservation attempt
            attemptReservation(position, playerName);
        }

        // Function to handle the reservation attempt and validation
        function attemptReservation(position, playerName) {
            const counts = getPoolCounts();
            let message = "";
            let isError = false;
            
            // --- Validation Checks ---
            if (counts.Total >= MAX_SLOTS.Total) {
                message = "The total pool is full (12 players).";
                isError = true;
            } else if (counts[position] >= MAX_SLOTS[position]) {
                message = `${position} slots are already full.`;
                isError = true;
            }
            
            // --- Process Reservation or Error ---
            const messageElement = document.getElementById('message');
            messageElement.className = '';
            
            if (isError) {
                messageElement.classList.add('error');
                messageElement.textContent = `üö´ Error: ${message}`;
                return;
            }
            
            // Reservation Successful
            // We use a timestamp to maintain the order in which spots were taken
            const reservation = { playerName: playerName, position: position, timestamp: Date.now() };
            MATCH_DATA.reservations.push(reservation);
            
            messageElement.classList.add('success');
            messageElement.textContent = `‚úÖ Success! ${playerName} reserved a ${position} slot.`;

            renderRoster(); // Update the list display
        }

        // Function to dynamically update the HTML list display
        function renderRoster() {
            const positionList = document.getElementById('position-list');
            positionList.innerHTML = ''; // Clear existing list items
            
            // Sort reservations by time to display them in the order they were taken
            const reservedSlots = [...MATCH_DATA.reservations].sort((a, b) => a.timestamp - b.timestamp);
            
            const renderedSlots = { Setter: 0, Outside: 0, Middle: 0, RS: 0 };
            
            // Loop 1: Render all occupied slots first
            reservedSlots.forEach(r => {
                const li = document.createElement('li');
                li.className = 'reserved-slot';
                
                // Increment count for the position that is being rendered
                renderedSlots[r.position]++;
                
                li.innerHTML = `<span class="pos-label">${r.position} Slot ${renderedSlots[r.position]}</span> 
                                <span class="player-info">${r.playerName} (TAKEN)</span>`;
                positionList.appendChild(li);
            });

            // Loop 2: Render all remaining OPEN slots
            for (const [position, max] of Object.entries(MAX_SLOTS)) {
                if (position === 'Total') continue;

                const openCount = max - renderedSlots[position];
                
                for (let i = 0; i < openCount; i++) {
                    const li = document.createElement('li');
                    li.className = 'available-slot';
                    
                    // The position for this slot is the key for the reservation logic
                    const currentSlotNumber = renderedSlots[position] + i + 1;
                    li.setAttribute('data-position', position);
                    li.onclick = () => handleReservationClick(position);
                    
                    li.innerHTML = `<span class="pos-label">${position} Slot ${currentSlotNumber}</span>
                                    <span class="player-info">CLICK TO RESERVE</span>`;
                    positionList.appendChild(li);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('match-details').textContent = 
                `Match #${MATCH_DATA.matchId} on ${MATCH_DATA.date} at ${MATCH_DATA.time} | Total Slots: ${MAX_SLOTS.Total}`;
            renderRoster(); // Display the initial empty roster
        });
    </script>